---
title: "Machine learning project"
author: "Hun Lee, Tucker Morgan, Zachary Katz"
date: "3/15/2022"
output: github_document
---

```{r setup, include=FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

Note that for binary variable, 1: yes & 0: No

sex : the gender of the observations. The variable is a binary named “male” in the dataset.

age : Age at the time of medical examination in years.

education : A categorical variable of the participants education, with the levels: Some high school (1), high school/GED (2), some college/vocational school (3), college (4)

currentSmoker: Current cigarette smoking at the time of examinations

cigsPerDay: Number of cigarettes smoked each day

BPmeds: Use of Anti-hypertensive medication at exam

prevalentStroke: Prevalent Stroke (0 = free of disease)

prevalentHyp: Prevalent Hypertensive. Subject was defined as hypertensive if treated

diabetes: Diabetic according to criteria of first exam treated

totChol: Total cholesterol (mg/dL)

sysBP: Systolic Blood Pressure (mmHg)

diaBP: Diastolic blood pressure (mmHg)

BMI: Body Mass Index, weight (kg)/height (m)^2

heartRate: Heart rate (beats/minute)

glucose: Blood glucose level (mg/dL)

And finally the response variable : + TenYearCHD : The 10 year risk of coronary heart disease(CHD).

```{r, echo = FALSE}
library(RCurl)
library(skimr)
library(caret)
library(tidyverse)
library(ggplot2)
library(corrplot)
library(RColorBrewer)
library(kableExtra)
library(dplyr)
library(tidymodels)
library(AppliedPredictiveModeling)
library(ggpubr)
library(patchwork)
```

```{r, warning=FALSE, message=FALSE, echo=FALSE}
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%")
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis")
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Importing and partitioning data

```{r}
x <- getURL("https://raw.githubusercontent.com/TarekDib03/Analytics/master/Week3%20-%20Logistic%20Regression/Data/framingham.csv")

data <- read.csv(text = x) %>% janitor::clean_names()

data <- distinct(data) # in case there are duplicated rows

set.seed(1)
split <- initial_split(data, prop = 0.8)

training_df <- 
  split %>% 
  training() %>%
  na.omit() %>%
  mutate(male = factor(male),
         education = factor(education),
         current_smoker = factor(current_smoker),
         bp_meds = factor(bp_meds),
         prevalent_stroke = factor(prevalent_stroke),
         prevalent_hyp = factor(prevalent_hyp),
         diabetes = factor(diabetes))  %>%
  mutate(ten_year_chd = ifelse(ten_year_chd == "1", "CHD","NoCHD") %>%
           fct_relevel("CHD", "NoCHD")) %>%
  rename(sex = male) %>%
  mutate(sex = ifelse(sex == "1", "male","female") %>%
           fct_relevel("male", "female"))

testing_df <- 
  split %>% testing()  %>%
  na.omit() %>%
  mutate(male = factor(male),
         education = factor(education),
         current_smoker = factor(current_smoker),
         bp_meds = factor(bp_meds),
         prevalent_stroke = factor(prevalent_stroke),
         prevalent_hyp = factor(prevalent_hyp),
         diabetes = factor(diabetes)) %>%
  mutate(ten_year_chd = ifelse(ten_year_chd == "1", "CHD","NoCHD") %>%
           fct_relevel("CHD", "NoCHD")) %>%
  rename(sex = male) %>%
  mutate(sex = ifelse(sex == "1", "male","female") %>%
           fct_relevel("male", "female"))

```

## Data summary

```{r}
skim(training_df) 
```


## Continuous variable exploratory analysis 

```{r, echo = FALSE}
M <- cor(training_df %>% select(where(is.numeric)))

corrplot::corrplot(M,  type = "lower",  order = "hclust",
                   col = brewer.pal(n = 8, name = "RdYlBu"), 
                   title = "Correlation Plot",
                   mar = c(1,1,1,1))

x <- training_df %>% select(where(is.numeric), -ten_year_chd)
x1 <- x %>% select(1,2,3,4)
x2 <- x %>% select(-1,-2,-3,-4)
x3 <-  training_df %>% select(where(is.factor)) 
y <- training_df$ten_year_chd
```


```{r, echo = FALSE, fig.width=13, fig.height=13}
transparentTheme(trans = .6)
featurePlot(x1, y, plot = "ellipse",
            auto.key = list(columns = 2))
```

```{r, echo = FALSE, fig.width=13, fig.height=13}
transparentTheme(trans = .6)
featurePlot(x2, y, plot = "ellipse",
            auto.key = list(columns = 2))
```


```{r, echo = FALSE, fig.width=13, fig.height=13}
transparentTheme(trans = .9)
featurePlot(x, y,
            plot = "density", 
            scales = list(x = list(relation = "free"), 
                          y = list(relation = "free")), 
            adjust = 1.5, 
            pch = "|", 
            layout = c(4, 1), 
            auto.key = list(columns = 2))
```


```{r, echo = FALSE, fig.width=13, fig.height=13}
transparentTheme(trans = .5)
featurePlot(x, y,
            plot = "box", 
            scales = list(x = list(rot = 90), 
                          y = list(relation = "free")), 
            adjust = 1.5, 
            layout = c(4, 1), 
            auto.key = list(columns = 2))
```

## Categorical variable exploratory analysis 

```{r, echo = FALSE, fig.width=13, fig.height=13}
x3 <- x3 %>% group_by(ten_year_chd) %>% mutate(count = 1)

p1 <- ggbarplot(x3, "ten_year_chd", "count", color = "sex", palette = "Paired")
p2 <- ggbarplot(x3, "ten_year_chd", "count", color = "education", palette = "Paired")
p3 <- ggbarplot(x3, "ten_year_chd", "count", color = "current_smoker", palette = "Paired")
p4 <- ggbarplot(x3, "ten_year_chd", "count", color = "bp_meds", palette = "Paired")
p5 <- ggbarplot(x3, "ten_year_chd", "count", color = "prevalent_stroke", palette = "Paired")
p6 <- ggbarplot(x3, "ten_year_chd", "count", color = "prevalent_hyp", palette = "Paired")
p7 <- ggbarplot(x3, "ten_year_chd", "count", color = "diabetes", palette = "Paired")

p1 + p2 + p3 + p4
```


```{r, echo = FALSE, fig.width=13, fig.height=13}
p5 + p6 + p7
```




